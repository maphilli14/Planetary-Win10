from sikuli.Sikuli import *
#
import subprocess, sys, os, os.path, shutil, ntpath, re
from SimpleXMLRPCServer import SimpleXMLRPCServer as Server
srv = Server(("127.0.0.1", 1337),allow_none=True) # as an example on the same machine
if not srv: exit(1)
#
setAutoWaitTimeout(90)
#
#
# -*- coding: UTF-8 -*-
#

def GIMPRGB(STACKEDFOLDER,RGB):
    try:
        click(Pattern("1593287670758.png").targetOffset(-25,-27))
        sleep(5)
        type('w',KEY_CTRL+KEY_SHIFT)
        sleep(2)
        click(Pattern("1593287670758.png").targetOffset(-25,-27))
        sleep(1)
        type('w',KEY_CTRL+KEY_SHIFT)
        sleep(0.2)
        click(Pattern("1593287670758.png").targetOffset(-25,-27))
        sleep(5)
 
        click(Pattern("1593287670758.png").targetOffset(-25,-27))
        sleep(1)
        type('f',KEY_ALT)
        sleep(0.2)
        type('o')
        sleep(0.2)
        wait("1517064575408.png")
        type('l',KEY_ALT)
        sleep(0.2)
        paste(os.path.join(STACKEDFOLDER,'temp'))
        sleep(0.2)
        type(Key.ENTER)
        sleep(1)
        click(Pattern("1517067301601.png").similar(0.85))
        type('a',KEY_CTRL)
        sleep(0.2)
        click(Pattern("1517067301601.png").similar(0.85))
        type('a',KEY_CTRL)
        sleep(0.2)
        click("1517067073574.png")
        sleep(5)
        waitVanish("1517065014495.png")
        sleep(5)
        click(Pattern("1593287670758.png").targetOffset(-25,-27))
        type('c',KEY_ALT)
        sleep(0.2)
        type('o')
        sleep(0.2)
        type('o')
        sleep(0.2)
        click(Pattern("1516830319137.png").similar(0.58).targetOffset(38,-38))
        sleep(0.2)
        click("1516831933131.png")
        sleep(0.2)
        click(Pattern("1516830319137.png").similar(0.63).targetOffset(34,5))
        sleep(0.2)
        click("1516831956391.png")
        sleep(0.2)
        click(Pattern("1516830319137.png").similar(0.59).targetOffset(35,46))
        sleep(0.2)
        click("1516831970389.png")
        sleep(0.2)
        click(Pattern("1516830977806.png").similar(0.81))
        sleep(5)
        waitVanish(Pattern("1516830977806.png").similar(0.81))        
        sleep(5)
        click(Pattern("1593287670758.png").targetOffset(-25,-27))
        sleep(0.2)
        type('e',KEY_CTRL+KEY_SHIFT)
        wait(Pattern("1516854495300.png").targetOffset(116,33))
        sleep(1.2)
        type('n',KEY_ALT)
        sleep(1.2)
        type('a',KEY_CTRL)
        sleep(1.2)
        type(Key.BACKSPACE)
        sleep(1.2)        
        paste(os.path.join(STACKEDFOLDER,'RGB',RGB.strip('.tif')))
        sleep(1.2)
        type(Key.END)
        sleep(1.2)        
        paste('.png')
        sleep(1.2)        
        type(Key.ENTER)
        sleep(5)
        if exists("1516832477260.png",2):
            click("1516832477260.png",2)
            sleep(2)
        else:
            pass
        sleep(4)
        wait(Pattern("1516833090528.png").similar(0.65).targetOffset(-5,15),10)
        click(Pattern("1516833090528.png").similar(0.64).targetOffset(-5,15),10)
        waitVanish(Pattern("1516833090528.png").similar(0.57).targetOffset(-5,15),10)
        sleep(15)
    except:
        pass

srv.register_function(GIMPRGB)
srv.serve_forever()
